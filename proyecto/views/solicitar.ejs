<main class="solicitar-page">
    <section class="solicitar-hero">
        <div>
            <p class="eyebrow">Solicitud manual</p>
            <h1>Coordinemos tu próximo trabajo</h1>
            <p>Completá los campos del formulario y revisá el calendario público del profesional. La fecha final se confirma por chat.</p>
        </div>
    </section>

    <div class="solicitar-grid">
        <div class="solicitar-left">
            <% if (typeof professional !== 'undefined' && professional) { %>
            <section class="solicitar-card profile-card">
                <h2>Profesional seleccionado</h2>
                <div class="profesional-card-compact">
                    <% if (professional.foto_url) { %>
                        <img src="<%= professional.foto_url %>" alt="<%= professional.nombre %>" class="profesional-avatar-small">
                    <% } else { %>
                        <div class="profesional-avatar-small profesional-avatar-placeholder"><%= professional.nombre.charAt(0) %></div>
                    <% } %>
                    <div class="profesional-info-compact">
                        <h3><%= professional.nombre %></h3>
                        <p class="especialidad"><%= professional.especialidad.charAt(0).toUpperCase() + professional.especialidad.slice(1) %></p>
                        <div class="rating">
                            <span class="rating-pill"><%= professional.calificacion_promedio ? professional.calificacion_promedio.toFixed(1) : '0.0' %></span>
                            <%= professional.trabajos_completados || 0 %> trabajos completados
                        </div>
                    </div>
                </div>
                <p class="profile-note">Toda la coordinación se realiza por escrito dentro de la plataforma. El profesional confirmará la fecha exacta luego de revisar tu solicitud.</p>
            </section>
            <% } %>

            <section class="solicitar-card">
                <h2>Detalles de tu Solicitud</h2>
                <form class="solicitar-form" method="POST" action="/solicitudes">
                    <% if (typeof professional !== 'undefined' && professional) { %>
                        <input type="hidden" name="profesional_id" value="<%= professional.id %>">
                    <% } %>

                    <div class="form-group">
                        <label for="tipo-servicio">Tipo de Servicio <span class="requerido">*</span></label>
                        <input type="text" id="tipo-servicio" name="tipo_servicio" required placeholder="Ej: Instalación eléctrica, Reparación">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fecha-preferida">Fecha Preferida <span class="requerido">*</span></label>
                            <input type="date" id="fecha-preferida" name="fecha_preferida" required>
                            <small>Elegí una fecha disponible del calendario</small>
                        </div>
                        <div class="form-group">
                            <label for="horario-preferido">Horario Preferido <span class="requerido">*</span></label>
                            <select id="horario-preferido" name="horario" required>
                                <option value="">Selecciona un horario</option>
                                <option value="mañana">Mañana (8:00 - 12:00)</option>
                                <option value="mediodia">Mediodía (12:00 - 15:00)</option>
                                <option value="tarde">Tarde (15:00 - 19:00)</option>
                                <option value="flexible">Horario flexible</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="descripcion">Descripción del Trabajo <span class="requerido">*</span></label>
                        <textarea id="descripcion" name="descripcion" rows="6" required placeholder="Describe detalladamente el trabajo que necesitas. Incluye ubicación exacta, materiales disponibles y cualquier restricción."></textarea>
                        <small>Mínimo 20 caracteres</small>
                    </div>

                    <div class="form-group">
                        <label for="direccion">Dirección del Trabajo <span class="requerido">*</span></label>
                        <input type="text" id="direccion" name="direccion" required placeholder="Calle, número, piso, departamento...">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="ciudad">Ciudad <span class="requerido">*</span></label>
                            <input type="text" id="ciudad" name="ciudad" required placeholder="Buenos Aires">
                        </div>
                        <div class="form-group">
                            <label for="codigo-postal">Código Postal</label>
                            <input type="text" id="codigo-postal" name="codigo_postal" placeholder="C1234ABC">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="presupuesto">Presupuesto Estimado (opcional)</label>
                        <input type="number" id="presupuesto" name="presupuesto_estimado" min="0" step="100" placeholder="Ej: 5000">
                        <small>Si tenés un rango, compartilo para acelerar la respuesta.</small>
                    </div>

                    <div class="info-box">
                        <h4>Información importante</h4>
                        <ul>
                            <li>El profesional responde por chat interno y confirma fecha final.</li>
                            <li>Podés adjuntar fotos y documentos de referencia.</li>
                            <li>Toda la conversación queda registrada como garantía.</li>
                        </ul>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancelar" onclick="history.back()">Cancelar</button>
                        <button type="submit" class="btn-enviar">Enviar solicitud</button>
                    </div>
                </form>
            </section>
        </div>

        <aside class="solicitar-right">
            <section class="solicitar-card calendario-section">
                <h2>Disponibilidad pública</h2>
                <p class="calendario-nota">El calendario refleja los bloques que el profesional marcó como libres. Podés sugerir cualquiera de esas fechas.</p>
                <div class="calendario-wrapper" data-solicitar-calendar>
                    <div class="calendario-header">
                        <button class="mes-btn" type="button" aria-label="Mes anterior" disabled>
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <polyline points="15 5 8 12 15 19" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                        <h3 id="mes-actual"><!-- Filled by JS --></h3>
                        <button class="mes-btn" type="button" aria-label="Mes siguiente">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <polyline points="9 5 16 12 9 19" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </button>
                    </div>
                    <div class="calendario-grid" id="calendario-grid">
                        <div class="dia-semana">L</div>
                        <div class="dia-semana">M</div>
                        <div class="dia-semana">M</div>
                        <div class="dia-semana">J</div>
                        <div class="dia-semana">V</div>
                        <div class="dia-semana">S</div>
                        <div class="dia-semana">D</div>
                        <!-- Days filled by JS -->
                    </div>
                    <div class="calendario-leyenda">
                        <span><span class="indicador disponible"></span> Disponible</span>
                        <span><span class="indicador ocupado"></span> Reservado</span>
                        <span><span class="indicador hoy"></span> Hoy</span>
                    </div>
                </div>
            </section>
        </aside>
    </div>
</main>

<script>
// Simple calendar initialization
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const mesActual = document.getElementById('mes-actual');
    const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
    if (mesActual) {
        mesActual.textContent = meses[now.getMonth()] + ' ' + now.getFullYear();
    }
    
    // Calendar click handler
    document.querySelectorAll('.dia.disponible').forEach(dia => {
        dia.addEventListener('click', function() {
            document.querySelectorAll('.dia.seleccionado').forEach(d => d.classList.remove('seleccionado'));
            this.classList.add('seleccionado');
            const fecha = this.getAttribute('data-fecha');
            if (fecha) {
                const input = document.getElementById('fecha-preferida');
                if (input) input.value = fecha;
            }
        });
    });
});
</script>
